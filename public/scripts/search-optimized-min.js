XA.component.locationService=function(){"use strict";var e,t,a,s,i={},n=!1,r=[],o=[];return e=function(e,a){var i;r.push(a),o.push(e),n||(n=!0,navigator.geolocation?navigator.geolocation.getCurrentPosition(function(e){for(i=0;i<o.length;i++)o[i]([e.coords.latitude,e.coords.longitude]);n=!1},function(){s("Error while detecting user location location"),n=!1},t()):(s("Your browser doesn't support geolocation"),n=!1))},t=function(){return-1!==a().indexOf("Chrome")?{enableHighAccuracy:!0,timeout:1e4,maximumAge:0}:{timeout:1e3,maximumAge:1/0}},a=function(){var e,t=navigator.userAgent,a=t.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(a[1])?"IE "+((e=/\brv[ :]+(\d+)/g.exec(t)||[])[1]||""):"Chrome"===a[1]&&null!=(e=t.match(/\b(OPR|Edge)\/(\d+)/))?e.slice(1).join(" ").replace("OPR","Opera"):(a=a[2]?[a[1],a[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(e=t.match(/version\/(\d+)/i))&&a.splice(1,1,e[1]),a.join(" "))},s=function(e){for(var t=0;t<r.length;t++)"function"==typeof r[t]&&r[t](e)},i.detectLocation=function(t,a){e(t,a)},i}(jQuery,document),XA.register("locationService",XA.component.locationService),XA.component.search={},XA.component.search.facet={},XA.component.search.results={},XA.component.search.vent=_.extend({},Backbone.Events),XA.component.search.ajax=(jQuery,document,new(Backbone.Model.extend({getData:function(e){var t=this.getPrameterByName("sc_site"),a=void 0!==e.excludeSiteName&&e.excludeSiteName?e.url:XA.component.search.url.createSiteUrl(e.url,t);Backbone.ajax({dataType:"json",url:a,success:function(t){e.callback(t)}})},getPrameterByName:function(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var a=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return a?a[2]?decodeURIComponent(a[2].replace(/\+/g," ")):"":null}}))),XA.component.search.baseModel=(jQuery,document,Backbone.Model.extend({sortFacetArray:function(e,t){switch(e){case"SortByCount":t.sort(function(e,t){return e.Count<t.Count})}}})),XA.register("searchBaseModel",XA.component.search.baseModel),XA.component.search.baseView=(jQuery,document,Backbone.View.extend({initialize:function(){},translateSignatures:function(e,t){var a,s;if(t=t.toLowerCase(),null==e)return[t];if(a=e.split(","),""===e)return[t];for(s=0;s<a.length;s++)a[s]=a[s]+"_"+t;return a},updateSignaturesHash:function(e,t,a){for(var s=0;s<e.length;s++)a[e[s]]=t;return a}})),XA.register("searchBaseView",XA.component.search.baseView),XA.component.search.box=function(e){var t,a,s={},i=[],n=[],r=!1,o=Backbone.Model.extend({defaults:{searchEngine:"",typeahead:"",dataProperties:{},searchQuery:"",loadingInProgress:!1,sig:[]},initSearchEngine:function(){var t=this,s=XA.component.search.ajax.getPrameterByName("sc_site"),i=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("name"),queryTokenizer:Bloodhound.tokenizers.whitespace,limit:t.get("dataProperties").p,remote:{url:a.createSiteUrl(t.createSuggestionsUrl(e.extend({l:t.getLanguage()},t.get("dataProperties")),t.get("searchQuery")),s),filter:function(e){return _.map(e.Results,function(e){return{html:e.Html}})},replace:function(){var i=t.get("valueProvider")(),n=e.extend({l:t.getLanguage()},t.get("dataProperties"));return a.createSiteUrl(t.createSuggestionsUrl(n,i),s)},ajax:{beforeSend:function(){t.set({loadingInProgress:!0})},complete:function(){t.set({loadingInProgress:!1})}}}});i.initialize(),this.set({searchEngine:i})},createSuggestionsUrl:function(e,t){var s=this.get("dataProperties").suggestionsMode,i=this.get("dataProperties").endpoint,n=this.get("dataProperties").suggestionEndpoint;switch(s){case"ShowPredictions":return a.createPredictiveSearchUrl(n,e,t);default:return a.createPredictiveSearchUrl(i,e,t)}},getSignature:function(){var e,t=this.get("dataProperties").searchResultsSignature;return null==t?"":(e=t.split(","),""===t?"":e[0])},getLanguage:function(){var e,t=this.get("dataProperties"),a=XA.component.search.results.searchResultModels,s=t.languageSource,i=this.getSignature();switch(s){case"CurrentLanguage":case"AllLanguages":return t.l;default:if(void 0!==(e=a.filter(function(e){return e.get("dataProperties").sig===i})[0]))return e.get("dataProperties").l}return""}}),l=XA.component.search.baseView.extend({initialize:function(){var e,t=this,a=this.$el.data();a.properties.targetSignature=null!==a.properties.targetSignature?a.properties.targetSignature:"",this.model.set({dataProperties:a.properties}),this.model.set("sig",this.translateSignatures(a.properties.searchResultsSignature,"q")),this.model.initSearchEngine(),this.model.on("change:loadingInProgress",this.loading,this),e=this.$el.find(".search-box-input").typeahead({hint:!0,minLength:2},{source:t.model.get("searchEngine").ttAdapter(),displayKey:function(){return t.$el.find(".search-box-input.tt-input").val()},templates:{suggestion:function(e){var t=a.properties.suggestionsMode,s=e.html.replace(/(<([^>]+)>)/gi,""),i=""!==s?s:e.html;switch(t){case"ShowPredictions":case"ShowSearchResultsAsPredictions":return'<div class="sugesstion-item">'+i+"</div>";default:return'<div class="sugesstion-item">'+e.html+"</div>"}}}}).on("typeahead:selected",this.suggestionSelected.bind(t)),this.model.set({typeahead:e}),this.model.set({valueProvider:function(){return t.$el.find(".search-box-input.tt-input").val()}}),XA.component.search.vent.on("hashChanged",this.updateSearchBoxValue.bind(this))},events:{"click .search-box-button":"updateQueryModelClick","click .search-box-button-with-redirect":"updateQueryWithRedirect","keypress .search-box-input.tt-input":"predictiveSearch","keydown .search-box-input.tt-input":"predictiveSearch"},loading:function(){this.$el.toggleClass("loading-in-progress")},suggestionSelected:function(t,a){t.preventDefault();var s,i=this.model.get("dataProperties").suggestionsMode,n=e(a.html).text(),r=""!=n?n:a.html;switch(i){case"ShowPredictions":case"ShowSearchResultsAsPredictions":this.performSearch(r);break;default:(s=e(a.html).find("a")).length&&(window.location.href=e(s[0]).attr("href"))}},updateQueryWithRedirect:function(e){e.preventDefault();var t,s=this.model.get("dataProperties").resultPage,i=this.model.get("dataProperties").targetSignature,n=this.model.get("dataProperties").searchResultsSignature,r=this.$el.find(".search-box-input.tt-input").val(),o=this.model.get("sig");t=""!==i?this.updateSignaturesHash([i+"_q"],r,this.createOffsetObject()):this.updateSignaturesHash(o,r,this.createOffsetObject()),window.location.href=a.createRedirectSearchUrl(s,t,n,i)},updateQueryModelClick:function(e){e.preventDefault();var t=this.$el.find(".search-box-input.tt-input").val();this.closeDropdown(),this.updateQueryModel(t)},updateQueryModel:function(e){for(var a={},s=this.translateSignatures(this.model.get("dataProperties").searchResultsSignature,"e"),i=this.model.get("sig"),n=0;n<i.length;n++)a[i[n]]=e,a[s[n]]=0;t.updateHash(a,this.model.get("dataProperties").targetUrl)},predictiveSearch:function(e){13===e.keyCode&&(e.preventDefault(),this.performSearch(this.$el.find(".search-box-input.tt-input").val()))},performSearch:function(e){var t=this.model.get("dataProperties"),s=t.targetSignature,i=t.searchResultsSignature,n=t.resultPage,r=this.model.get("sig"),o={};this.closeDropdown(),""===n?(this.updateQueryModel(e),this.$el.find(".search-box-input.tt-input").blur().val(e)):(o=""!==s?this.updateSignaturesHash([s+"_q"],e,this.createOffsetObject()):this.updateSignaturesHash(r,e,this.createOffsetObject()),window.location.href=a.createRedirectSearchUrl(n,o,i,s))},createOffsetObject:function(){for(var e=this.model.get("sig"),t=this.model.get("dataProperties").targetSignature,a=""!==t?t:this.model.get("dataProperties").searchResultsSignature,s=this.translateSignatures(a,"e"),i={},n=0;n<e.length;n++)i[s[n]]=0;return i},updateSearchBoxValue:function(){for(var e=t.parseHashParameters(window.location.hash),a=this.$el.find(".search-box-input.tt-input"),s=this.model.get("sig"),i=0;i<s.length;i++)e.hasOwnProperty(s[i])?a.val(e[s[i]]):a.val("")},closeDropdown:function(){this.$el.find(".search-box-input").typeahead("close")}});return s.init=function(){if(!e("body").hasClass("on-page-editor")&&!r){t=XA.component.search.query,XA.component.search.results.searchResultModels,a=XA.component.search.url;var s=e(".search-box:not(.initialized)");_.each(s,function(t){var a=e(t),s=new o;n.push(s),i.push(new l({el:a,model:s})),a.addClass("initialized")}),r=!0}},s.searchBoxViews=i,s.searchBoxModels=n,s}(jQuery,document),XA.register("searchBox",XA.component.search.box),XA.component.search.facet.data=function(e){return new(Backbone.Model.extend({defaults:{},initialize:function(){},getInitialFacetData:function(){var e,t=this.getFacetRequestData(),a=t.data,s=[];for(var i in a)a.hasOwnProperty(i)&&(s=(s=s.concat(a[i].normalFiltering)).concat(a[i].partialFiltering),e=this.getSearchResultsLanguage(i),s.length>0&&XA.component.search.ajax.getData({callback:function(e){XA.component.search.vent.trigger("facet-data-loaded",e)},url:XA.component.search.url.createMultiFacetUrl({endpoint:t.endpoint,s:t.s,l:e},s,i)}))},filterFacetData:function(t){var a,s,i,n,r,o=this.getFacetRequestData(t),l=o.data;for(var c in l)l.hasOwnProperty(c)&&(s=this.getSearchResultsLanguage(c),i=this.getSearchResultsScope(c),n=this.getSearchResultsModelBySignature(c),r=n.get("dataProperties").itemid,l[c].normalFiltering.length>0&&(a=e.extend({endpoint:o.endpoint,s:i,l:s},t),XA.component.search.ajax.getData({callback:function(e){XA.component.search.vent.trigger("facet-data-filtered",e)},url:XA.component.search.url.createMultiFacetUrl(a,l[c].normalFiltering,c,r)})),l[c].partialFiltering.length>0&&_.each(l[c].partialFiltering,function(n){var l=e.extend({},t);delete l[""!==c?c+"_"+n:n],delete l[""!==c?c+"_"+n.toLowerCase():n.toLowerCase()],a=e.extend({endpoint:o.endpoint,s:i,l:s},l),XA.component.search.ajax.getData({callback:function(e){XA.component.search.vent.trigger("facet-data-partial-filtered",e)},url:XA.component.search.url.createMultiFacetUrl(a,[n],c,r)})}))},getFacetRequestData:function(e){var t,a,s,i,n=this,r=[],o={};for(t in XA.component.search.facet)"function"==typeof(a=XA.component.search.facet[t]).getFacetDataRequestInfo&&(r=a.getFacetDataRequestInfo(),_.each(r,function(t){i=""!==t.signature?t.signature+"_"+t.facetName:t.facetName,o.hasOwnProperty(t.signature)||n.initRequestObject(o,t),t.filterWithoutMe&&(void 0===e||e.hasOwnProperty(i)||e.hasOwnProperty(i.toLowerCase()))?(o[t.signature].partialFiltering.push(t.facetName),s=t.endpoint):(o[t.signature].normalFiltering.push(t.facetName),s=t.endpoint)}));return{endpoint:s,data:o}},initRequestObject:function(e,t){e[t.signature]={},e[t.signature].normalFiltering=[],e[t.signature].partialFiltering=[]},getSearchResultsLanguage:function(e){var t=this.getSearchResultsModelBySignature(e);return void 0!==t?t.get("dataProperties").l:""},getSearchResultsScope:function(e){var t=this.getSearchResultsModelBySignature(e);return void 0!==t?t.get("dataProperties").s:""},getSearchResultsModelBySignature:function(e){return XA.component.search.results.searchResultModels.filter(function(t){return t.get("dataProperties").sig===e})[0]}}))}(jQuery,document),XA.component.search.facet.dropdown=function(e){"use strict";var t,a={},s=!1,i=XA.component.search.baseModel.extend({defaults:{template:"<% _.forEach(results, function(result){%><option data-facetName='<%= result.Name !== '' ? result.Name : '_empty_' %>' <%= result.Selected !== undefined ? 'selected' : '' %> ><%= result.Name !== '' ? result.Name : emptyText %> (<%= result.Count %>)</option><%}); %>",dataProperties:{},blockNextRequest:!1,resultData:{},optionSelected:!1,sig:[]},initialize:function(){XA.component.search.vent.on("facet-data-loaded",this.processData.bind(this)),XA.component.search.vent.on("facet-data-filtered",this.processData.bind(this)),XA.component.search.vent.on("facet-data-partial-filtered",this.processData.bind(this)),XA.component.search.vent.on("hashChanged",this.updateComponent.bind(this))},toggleBlockRequests:function(){var e=this.get("blockNextRequest");this.set(this.get("blockNextRequest"),!e)},processData:function(e){for(var a,s,i,n=this,r=t.parseHashParameters(window.location.hash),o=n.get("sig"),l=this.get("dataProperties"),c=l.searchResultsSignature.split(","),d=l.sortOrder,h=l.f,u=0;u<c.length;u++)if(e.Facets.length>0&&e.Signature===c[u]||""===e.Signature||null===e.Signature){if(void 0===(s=_.find(e.Facets,function(e){return e.Key.toLowerCase()===h.toLowerCase()})))return;for(i=0;i<o.length;i++)jQuery.isEmptyObject(_.pick(r,o[i]))||""!==r[o[i]]&&(0===(a=_.where(s.Values,{Name:r[o[i]]})).length&&(a=_.where(s.Values,{Name:""})),a.length>0&&(a[0].Selected=!0,n.optionSelected=!0));this.sortFacetArray(d,s.Values),n.set({resultData:s.Values})}},updateComponent:function(e){for(var t,a=this.get("sig"),s=0;s<a.length;s++)t=a[s].toLowerCase(),e.hasOwnProperty(t)&&""!==e[t]?this.set({optionSelected:!0}):this.set({optionSelected:!1})}}),n=XA.component.search.baseView.extend({initialize:function(){var e=this.$el.data();this.properties=e.properties,this.model&&(this.model.set({dataProperties:this.properties}),this.model.set("sig",this.translateSignatures(this.properties.searchResultsSignature,this.properties.f))),this.model.on("change",this.render,this)},events:{"change .facet-dropdown-select":"updateFacet","click .bottom-remove-filter, .clear-filter":"clearFilter"},updateFacet:function(){var e=this.$el.find(".facet-dropdown-select").find("option:selected").data("facetname"),a=this.model.get("sig");""===e?this.model.set({optionSelected:!1}):this.model.set({optionSelected:!0}),t.updateHash(this.updateSignaturesHash(a,e,{}))},render:function(){var t=this,a=t.model.get("resultData"),s=this.$el.find(".facet-dropdown-select"),i=t.model.get("dataProperties").emptyValueText,n=this.$el.find(".facet-heading > span"),r=s.find("option:first"),o=e("<option />"),l=_.template(t.model.get("template"))({results:a,emptyText:i});o.text(r.text()),o.data("facetname",""),this.model.get("optionSelected")?n.addClass("has-active-facet"):""===r.data("facetname")&&n.removeClass("has-active-facet"),s.empty().append(o).append(l)},clearFilter:function(){var e=this.$el.find(".facet-dropdown-select"),a=this.$el.find(".facet-heading > span"),s=this.model.get("sig");t.updateHash(this.updateSignaturesHash(s,"",{})),this.model.set({optionSelected:!1}),a.removeClass("has-active-facet"),e.val(e.find("option:first").val())}});return a.init=function(){if(!e("body").hasClass("on-page-editor")&&!s){t=XA.component.search.query,XA.component.search.url;var a=e(".facet-dropdown");_.each(a,function(t){new n({el:e(t),model:new i})}),s=!0}},a.getFacetDataRequestInfo=function(){var t=e(".facet-dropdown"),a=[];return _.each(t,function(t){for(var s=e(t).data().properties,i=s.searchResultsSignature.split(","),n=0;n<i.length;n++)a.push({signature:null===i[n]?"":i[n],facetName:s.f,endpoint:s.endpoint,filterWithoutMe:!0})}),a},a}(jQuery,document),XA.register("facetDropdown",XA.component.search.facet.dropdown),XA.component.search.facet.managedrange=function(e){var t,a={},s=Backbone.Model.extend({defaults:{dataProperties:{},sig:[]}}),i=XA.component.search.baseView.extend({initialize:function(){this.properties=this.$el.data().properties,this.model&&(this.model.set({dataProperties:this.properties}),this.model.set("sig",this.translateSignatures(this.properties.searchResultsSignature,this.properties.f))),0===this.$el.find(".filterButton").length&&(this.$el.find(".manualRangeMin").on("blur",this.textBoxChange.bind(this,[])),this.$el.find(".manualRangeMax").on("blur",this.textBoxChange.bind(this,[]))),this.model.on("change",this.render,this),XA.component.search.vent.on("hashChanged",this.updateComponent.bind(this))},events:{"click .faceLink":"linkClick","click .facetRadio":"radioClick","click .facetCheckbox":"checkBoxClick","click .filterButton":"filter","click .bottom-remove-filter, .clear-filter":"clearFilter","keyup .manualRangeMin, .manualRangeMax":"configureKeyCodes"},configureKeyCodes:function(e){13==e.keyCode&&this.filter()},updateHash:function(a){var s=this.model.get("sig"),i=[];_.each(a,function(t){var a=e(t);i.push(a.data().minvalue+"|"+a.data().maxvalue)}),this.$el.find(".manualRangeMin").val(""),this.$el.find(".manualRangeMax").val(""),t.updateHash(this.updateSignaturesHash(s,i.join(","),{}))},render:function(){for(var a,s=t.parseHashParameters(window.location.hash),i=this.$el.find(".facet-heading > span"),n=this.model.get("sig"),r=this,o=0;o<n.length;o++)s.hasOwnProperty(n[o])&&""!==s[n[o]]&&(a=s[n[o]].split(","),i.addClass("has-active-facet"),_.each(a,function(t){var a,s,i=t.split("|"),n=i[0],o=i[1];(""!==n||""!==o)&&(""!==n&&""!==o?a=".facetCheckbox[data-minvalue='"+n+"'][data-maxvalue='"+o+"'], .facetRadio[data-minvalue='"+n+"'][data-maxvalue='"+o+"']":""!==n&&""===o?a=".facetCheckbox[data-minvalue='"+n+"'], .facetRadio[data-minvalue='"+n+"']":""===n&&""!==o&&(a=".facetCheckbox[data-maxvalue='"+o+"'], .facetRadio[data-maxvalue='"+o+"']"),(s=e(a)).length>0?s.attr("checked","checked"):(r.$el.find(".manualRangeMin").val(i[0]),r.$el.find(".manualRangeMax").val(i[1])))}))},radioClick:function(t){var a=e(t.currentTarget);e(".facetRadio").attr("name",a.attr("name")),this.updateHash(a)},checkBoxClick:function(t){e(t.currentTarget).is(":checked")&&(this.$el.find(".manualRangeMin").val(""),this.$el.find(".manualRangeMax").val(""))},linkClick:function(a){var s=e(a.currentTarget),i=s.data().minvalue+"|"+s.data().maxvalue;this.$el.find(".facetCheckbox[data-shortid!="+s.data().shortid+"]").removeAttr("checked"),this.$el.find(".facetCheckbox[data-shortid="+s.data().shortid+"]").attr("checked","checked"),this.$el.find(".manualRangeMin").val(""),this.$el.find(".manualRangeMax").val(""),t.updateHash(this.updateSignaturesHash(sig,i,{}))},filter:function(){var e,a,s=this.model.get("dataProperties").multipleSelection,i=this.$el.find(".facetCheckbox:checked"),n=this.$el.find(".facetRadio:checked"),r=this.$el.find(".manualRangeMin"),o=this.$el.find(".manualRangeMax"),l=this.model.get("sig");e=r.length>0&&""!==r.val()?r.val():"",a=o.length>0&&""!==o.val()?o.val():"",""!==e||""!==a?(this.$el.find(".facetRadio").removeAttr("checked"),this.$el.find(".facetCheckbox").removeAttr("checked"),t.updateHash(this.updateSignaturesHash(l,e+"|"+a,{}))):(i.length>0||n.length>0)&&(s?this.updateHash(i):this.radioClick({currentTarget:n}))},clearFilter:function(){for(var e=this.$el.find(".manualRangeMin"),a=this.$el.find(".manualRangeMax"),s=this.model.get("dataProperties"),i=(this.$el.data("properties"),this.$el.find(".facet-heading > span")),n=t.parseHashParameters(window.location.hash),r=this.model.get("sig"),o=0;o<r.length;o++)delete s[r[o]],n[r[o]]="";t.updateHash(n),this.model.set({dataProperties:s}),this.$el.find(".facetCheckbox").removeAttr("checked"),this.$el.find(".facetRadio").removeAttr("checked"),i.removeClass("has-active-facet"),e.length>0&&e.val(e.data().defaultvalue),a.length>0&&a.val(a.data().defaultvalue)},textBoxChange:function(){var e=this.$el.find(".manualRangeMin"),a=this.$el.find(".manualRangeMax"),s=e.length>0&&""!==e.val()?e.val():"",i=a.length>0&&""!==a.val()?a.val():"",n=this.model.get("sig");this.$el.find(".facetRadio").removeAttr("checked"),this.$el.find(".facetCheckbox").removeAttr("checked"),""!==s||""!==i?t.updateHash(this.updateSignaturesHash(n,s+"|"+i,{})):t.updateHash(this.updateSignaturesHash(n,"",{}))},updateComponent:function(e){for(var t,a=this.model.get("sig"),s=0;s<a.length;s++)t=a[s].toLowerCase(),e.hasOwnProperty(t)?this.render():this.clearFilter()}});return a.init=function(){if(!e("body").hasClass("on-page-editor")){t=XA.component.search.query,XA.component.search.ajax,XA.component.search.url;var a=e(".facet-managed-range");_.each(a,function(t){var a=new s;new i({el:e(t),model:a}).render()}),initialzied=!0}},a}(jQuery,document),XA.register("managedrange",XA.component.search.facet.managedrange),XA.component.search.facet.rangeslider=function(e){var t,a={},s=Backbone.Model.extend({defaults:{dataProperties:{},sig:[],timeStamp:""}}),i=XA.component.search.baseView.extend({initialize:function(){var e=this.$el.data();this.properties=e.properties,this.model&&(this.model.set({dataProperties:this.properties}),this.model.set("sig",this.translateSignatures(this.properties.searchResultsSignature,this.properties.f))),this.model.on("change",this.updateSelectedValue,this),XA.component.search.vent.on("hashChanged",this.updateModel.bind(this)),this.render()},events:{"click .bottom-remove-filter, .clear-filter":"removeFacet","mouseup .ui-slider-handle":"updateModel"},render:function(){for(var t,a,s,i=this,n=this.model.get("sig"),r=XA.component.search.query.parseHashParameters(window.location.hash),o=parseFloat(this.model.get("dataProperties").minRangeValue),l=parseFloat(this.model.get("dataProperties").maxRangeValue),c=parseFloat(this.model.get("dataProperties").changeStep),d=e("<div />").addClass("slider-value"),h=this.$el.find(".facet-heading > span"),u=this.$el.find(".slider"),p=0;p<n.length;p++)jQuery.isEmptyObject(_.pick(r,n[p]))?(t=parseFloat(this.model.get("dataProperties").selectedMinValue),a=parseFloat(this.model.get("dataProperties").selectedMaxValue),h.removeClass("has-active-facet")):(s=_.values(_.pick(r,n[p]))[0])&&(t=s.split("|")[0],a=s.split("|")[1],h.addClass("has-active-facet"));isNaN(o)&&(o=0),isNaN(l)&&(l=0),(isNaN(c)||0===c)&&(c=1),isNaN(t)&&(t=0),isNaN(a)&&(a=0),u.slider({range:!0,min:o,max:l,step:c,values:[t,a],create:function(){e(".slider-value").remove(),u.after(d),(0!==t||0!==a)&&i.updateText(t,a)},slide:function(e,t){i.updateModel(i.updateSignaturesHash(n,t.values[0]+"|"+t.values[1],{}))}})},removeFacet:function(){var e=this.$el,a=this.model.get("sig"),s=this.$el.find(".slider"),i=e.find(".facet-heading > span"),n=this.model.get("dataProperties"),r=t.parseHashParameters(window.location.hash);i.removeClass("has-active-facet"),n.selectedMinValue=n.minRangeValue,n.selectedMaxValue=n.maxRangeValue,this.updateText(n.minRangeValue,n.maxRangeValue),s.slider("values",[n.minRangeValue,n.maxRangeValue]),this.model.set({dataProperties:n}),r.hasOwnProperty(this.model.get("sig"))&&t.updateHash(this.updateSignaturesHash(a,"",r))},updateModel:function(e){var a,s,i,n,r,o,l=this.model.get("sig");for(e||(e=t.parseHashParameters(window.location.hash)),o=0;o<l.length;o++)if(a=l[o].toLocaleString(),e.hasOwnProperty(a))if(""!==(i=_.values(_.pick(e,a))[0])){if(n=i.split("|")[0],void 0===(r=i.split("|")[1])||void 0===n)continue;(s=this.model.get("dataProperties")).selectedMinValue=n,s.selectedMaxValue=r,this.model.set("dataProperties",s),this.model.set("timeStamp",(new Date).getTime())}else this.removeFacet()},updateSelectedValue:function(){var e=this.model.get("dataProperties"),a=e.selectedMinValue,s=e.selectedMaxValue,i=this.$el.find(".slider"),n=this.model.get("sig");i.slider("values",[a,s]),this.updateText(a,s),this.$el.find(".facet-heading > span").addClass("has-active-facet"),t.updateHash(this.updateSignaturesHash(n,a+"|"+s,{}))},updateText:function(e,t){var a=this.$el.find(".slider-value"),s=this.model.get("dataProperties").formatingString;s=s.replace("{from}",e).replace("{to}",t),a.html(s)}});return a.init=function(){t=XA.component.search.query,XA.component.search.url;var a=e(".facet-range-selector");_.each(a,function(t){var a=new s;new i({el:e(t),model:a})}),!0},a}(jQuery,document),XA.register("searchFacetRangeSlider",XA.component.search.facet.rangeslider),XA.component.search.facet.slider=function(e){var t,a={},s=Backbone.Model.extend({defaults:{dataProperties:{},selectedValue:null,sig:[],timeStamp:""}}),i=XA.component.search.baseView.extend({initialize:function(){var e=this.$el.data();this.properties=e.properties,this.model&&(this.model.set({dataProperties:this.properties}),this.model.set("sig",this.translateSignatures(this.properties.searchResultsSignature,this.properties.f))),this.model.on("change",this.updateSelectedValue,this),XA.component.search.vent.on("hashChanged",this.updateModel.bind(this)),this.render()},events:{"click .bottom-remove-filter, .clear-filter":"removeFacet","mouseup .ui-slider-handle":"updateModel"},render:function(){var a=this,s=this.model.get("sig"),i=this.model.get("dataProperties"),n=t.parseHashParameters(window.location.hash),r=parseFloat(i.minValue),o=parseFloat(i.maxValue),l=_.isEmpty(_.pick(n,i.f))?parseFloat(i.selectedValue):_.values(_.pick(n,i.f))[0],c=parseFloat(i.changeStep),d=e("<div />").addClass("slider-value"),h=this.$el.find(".slider");t=XA.component.search.query,XA.component.search.url,isNaN(r)&&(r=0),isNaN(o)&&(o=0),isNaN(c)&&(c=1),isNaN(l)&&(l=0),h.slider({min:r,max:o,step:c,value:l,slide:function(e,t){a.updateModel(a.updateSignaturesHash(s,t.value,{}))}}),e(".slider-value").remove(),d.html(i.formatingString.replace("{value}",l)),h.after(d)},removeFacet:function(){var e=this.$el,a=this.model.get("sig"),s=this.$el.find(".slider"),i=this.$el.find(".slider-value"),n=e.find(".facet-heading > span"),r=this.model.get("dataProperties"),o=e.data("properties"),l=o.f;n.removeClass("has-active-facet"),i.html(""),s.slider("value",o.minValue),r[l]="",t.updateHash(this.updateSignaturesHash(a,"",{})),this.model.set({dataProperties:r})},updateModel:function(e){var a,s,i,n,r=this.model.get("sig");for(e||(e=t.parseHashParameters(window.location.hash)),n=0;n<r.length;n++)s=r[n].toLowerCase(),e.hasOwnProperty(s)&&(""!==(i=_.values(_.pick(e,s))[0])?((a=this.model.get("dataProperties")).selectedValue=i,this.model.set("dataProperties",a),this.model.set("timeStamp",(new Date).getTime())):this.removeFacet())},updateSelectedValue:function(){var e,a=this.model.get("dataProperties"),s=a.selectedValue,i=this.$el.find(".slider-value"),n=this.$el.find(".slider"),r=this.model.get("sig");n.slider("value",s),e=a.formatingString.replace("{value}",s),i.html(e),this.$el.find(".facet-heading > span").addClass("has-active-facet"),t.updateHash(this.updateSignaturesHash(r,s,{}))}});return a.init=function(){t=XA.component.search.query,XA.component.search.url;var a=e(".facet-slider");_.each(a,function(t){var a=new s;new i({el:e(t),model:a})}),!0},a}(jQuery,document),XA.register("searchFacetSlider",XA.component.search.facet.slider),XA.component.search.loadMore=function(e){var t,a,s={},i=!1;return t=Backbone.Model.extend({defaults:{dataProperties:{},sig:[]}}),a=Backbone.View.extend({initialize:function(){var e=this.$el.data(),t=this;null===e.properties.searchResultsSignature&&(e.properties.searchResultsSignature=""),this.model&&this.model.set("sig",e.properties.searchResultsSignature.split(",")),XA.component.search.vent.on("results-loaded",function(e){for(var a=t.model.get("sig"),s=0;s<a.length;s++)e.pageSize>=e.dataCount?t.$el.hide():a[s]===e.searchResultsSignature&&(e.offset+e.pageSize>=e.dataCount?t.$el.hide():t.$el.show())})},events:{"mousedown input":"loadMore"},loadMore:function(){for(var e=this.model.get("sig"),t=0;t<e.length;t++)XA.component.search.vent.trigger("loadMore",{sig:e[t]})}}),s.init=function(){if(!e("body").hasClass("on-page-editor")&&!i){var s=e(".load-more");_.each(s,function(s){new a({el:e(s),model:new t})}),i=!0}},s}(jQuery,document),XA.register("searchLoadMore",XA.component.search.loadMore),XA.component.search.locationfilter=function(e){"use strict";var t,a,s,i,n={},r=[],o=!1,l=!1,c=XA.connector.mapsConnector;return i=function(){for(var e=0;e<r.length;e++)new s({el:r[e],model:new a})},a=Backbone.Model.extend({defaults:{dataProperties:{},sig:[]},initAutocompleteEngine:function(){var e,t=this;t.get("dataProperties").p>0&&((e=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("name"),queryTokenizer:Bloodhound.tokenizers.whitespace,limit:t.get("dataProperties").p,remote:{url:"-",replace:function(){return Date.now().toString()},transport:function(e,a,s){var i=t.get("queryParams");i.text?c.locationAutocomplete(i,function(e){var t=e.map(function(e){return e.hasOwnProperty("text")?e.text:e});a(t)},function(){s("Could not autocomplete")}):a([])}}})).initialize(),this.set({searchEngine:e}))}}),s=XA.component.search.baseView.extend({initialize:function(){var e,t=this,a=this.$el.data(),s=this.$el.find(".location-search-box-input"),i=a.properties.searchResultsSignature.split(",");null===a.properties.searchResultsSignature&&(a.properties.searchResultsSignature=""),this.model.set({dataProperties:a.properties}),this.model.set({sig:i}),this.model.set({queryParams:{maxResults:a.p,text:""}}),this.model.initAutocompleteEngine(),(e=this.model.get("searchEngine"))&&s.typeahead({hint:!0,minLength:2},{source:e.ttAdapter(),templates:{suggestion:function(e){return'<div class="suggestion-item">'+e+"</div>"}}}).on("typeahead:selected",function(e,a){t.translateUserLocation(a),s.typeahead("val",a)}),this.addressLookup(),XA.component.search.vent.on("hashChanged",function(e){var t=e[i.length>0&&""!==i[0]?i[0]+"_a":"a"];null!=t&&""!==t&&s.val(t)})},events:{"click .location-search-box-button":"addressLookup","keypress .location-search-box-input":"searchTextChanges","keyup .location-search-box-input":"autocomplete"},addressLookup:function(){var e,t=this.model.get("dataProperties"),a={text:this.getAddress(),maxResults:1};if(""===a.text)return e=this.createHashObject("",""),void this.updateHash(e,t);switch(t.mode){case"Location":this.detectLocation();break;case"UserProvided":this.translateUserLocation(a);break;case"Mixed":void 0===a.text||""===a.text?this.detectLocation():this.translateUserLocation(a)}},getAddress:function(){var e,a=this.$el.find(".location-search-box-input.tt-input"),s=0!==a.length?a.val():this.$el.find(".location-search-box-input").val(),i=t.parseHashParameters(window.location.hash),n=this.model.get("sig");return(""===s||void 0===s)&&(""!==(e=i[n.length>0&&""!==n[0]?n[0]+"_a":"a"])&&(s=e),void 0===s&&(s="")),s},autocomplete:function(e){var t,a,s=this.model.get("dataProperties");e.stopPropagation(),13!==e.keyCode&&(a={text:0!==(t=this.$el.find(".location-search-box-input.tt-input")).length?t.val():this.$el.find(".location-search-box-input").val(),maxResults:s.p},this.model.set({queryParams:a}))},searchTextChanges:function(e){return e.stopPropagation(),13!==e.keyCode||(this.addressLookup(e),!1)},translateUserLocation:function(e){var t=this,a=this.model.get("dataProperties"),s=void 0!==e.text?e.text:e,i=this.$el.find(".location-search-box-input.tt-input"),n={};""!==s&&(c.addressLookup({text:s},function(e){n=t.createHashObject(e[0]+"|"+e[1],a.f+",Ascending"),t.updateHash(n,a)},function(){console.error("Error while getting '"+s+"' location")}),i.blur(),""===i.val()&&i.val(s))},detectLocation:function(){var e=this.model.get("dataProperties"),a=this.$el.find(".location-search-box-input"),s=(this.model.get("sig"),t.parseHashParameters(window.location.hash),{}),i=this;XA.component.locationService.detectLocation(function(t){s=i.createHashObject(t[0]+"|"+t[1],e.f+",Ascending"),i.updateHash.call(i,s,e),a.length>0&&a.attr("placeholder",e.myLocationText)},function(e){console.log(e)})},updateHash:function(e,a){for(var s,i,n=this.model.get("sig"),r=void 0!==XA.component.search?XA.component.search.results.searchResultModels:[],o=this.$el.find(".location-search-box-input.tt-input"),l=0!==o.length?o.val():this.$el.find(".location-search-box-input").val(),c=0;c<r.length;c++)for(i=0;i<n.length;i++)s=n[i],r[c].get("dataProperties").sig===s&&r[c].set("loadMoreOffset",0);if(null!==l&&""!==l)for(c=0;c<n.length;c++)e[""!==(s=n[c])?s+"_a":"a"]=l;for(t.updateHash(e,a.targetUrl),c=0;c<n.length;c++)XA.component.search.vent.trigger("my-location-coordinates-changed",{sig:n[c],coordinates:e[""!==n[c]?n[c]+"_g":"g"].split("|")})},createHashObject:function(e,t){for(var a,s=this.model.get("sig"),i={},n=0;n<s.length;n++)i[""!==(a=s[n])?a+"_g":"g"]=e,i[""!==a?a+"_o":"o"]=t;return i}}),n.init=function(){if(!e("body").hasClass("on-page-editor")&&!o){t=XA.component.search.query,XA.component.search.url;var a=e(".location-filter:not(.initialized)");_.each(a,function(t){var a=e(t),s=a.data("properties");r.push(a),l||"Location"===s.mode?i():c.loadScript(s.key,XA.component.search.locationfilter.scriptsLoaded),a.addClass("initialized")}),o=!0}},n.scriptsLoaded=function(){l||(console.log("Maps api loaded"),l=!0,i())},n}(jQuery,document),XA.register("locationfilter",XA.component.search.locationfilter),XA.component.search.pageSelector=function(e){var t,a,s,i={},n=!1;return facetName="e",a=Backbone.Model.extend({defaults:{dataProperties:{},resultsCount:0,offset:0,selectedValue:1,pageSize:0,repeatRequest:!1,template:"<ul class='page-selector-list'> <li class='page-selector-item-first'><a href='#'><%= data.first %></a></li><li class='page-selector-item-previous'><a href='#'><%= data.previous %></a></li><% var beforePage = 0; %><% _.each(data.pages, function(page){ %><% if((beforePage+1) != page.number){ %><li><span class='page-selector-more'>...</span></li><% } %><% beforePage = page.number; %><% if(data.selectedValue === page.number){ %><% active = 'active'; %><% }else { active = '' } %><li><a class='page-selector-item-link <%= active %>' data-offset='<%= page.offset %>' data-itemNumber='<%= page.number %>' href='#'><%= page.number %></a></li><% }); %><li class='page-selector-item-next'><a href='#'><%= data.next %></a></li><li class='page-selector-item-last'><a href='#'><%= data.last %></a></li></ul>",sig:[],timeStamp:(new Date).getTime()}}),s=XA.component.search.baseView.extend({initialize:function(){var e=this.$el.data();null===e.properties.searchResultsSignature&&(e.properties.searchResultsSignature=""),this.model.set("dataProperties",e),this.model.set("sig",this.translateSignatures(e.properties.searchResultsSignature,facetName)),this.model.on("change",this.render,this),XA.component.search.vent.on("results-loaded",this.handleLoadedData.bind(this)),window.location.href.startsWith("file://")&&this.model.set({resultsCount:10,pageSize:2,selectedValue:2})},events:{"click .page-selector-item-link":"updateSelectedValue","click .page-selector-item-first a":"showFirstPage","click .page-selector-item-last a":"showLastPage","click .page-selector-item-previous a":"showPrevPage","click .page-selector-item-next a":"showNextPage"},updateModelAfterSearch:function(e,t){this.model.set({pageSize:parseInt(e.pageSize),resultsCount:parseInt(e.dataCount),offset:parseInt(e.offset),selectedValue:parseInt(t)}),this.model.set("timeStamp",(new Date).getTime()),this.updateElementCssClass(e)},updateElementCssClass:function(e){this.el.classList.remove("page-selector-empty"),this.el.classList.remove("page-selector-single-page"),0===e.dataCount?this.el.classList.add("page-selector-empty"):(e.pageSize>e.dataCount||e.offset>e.dataCount)&&this.el.classList.add("page-selector-single-page")},updateSelectedValue:function(a){a.preventDefault();var s=this.model.get("sig"),i=e(a.target).data();t.updateHash(this.updateSignaturesHash(s,i.offset,{}))},showFirstPage:function(a){a.preventDefault();var s=this.model.get("sig");e(a.target).data();t.updateHash(this.updateSignaturesHash(s,0,{}))},showLastPage:function(e){e.preventDefault();var a=this.model.get("resultsCount")%this.model.get("pageSize"),s=this.model.get("resultsCount")-(0===a?this.model.get("pageSize"):a),i=this.model.get("sig");t.updateHash(this.updateSignaturesHash(i,s,{}))},showNextPage:function(e){e.preventDefault();var a=this.model.get("offset"),s=this.model.get("sig");a+this.model.get("pageSize")<this.model.get("resultsCount")&&(a+=this.model.get("pageSize")),t.updateHash(this.updateSignaturesHash(s,a,{}))},showPrevPage:function(a){a.preventDefault();var s=this.model.get("offset"),i=(e(a.target).data(),this.model.get("sig"));s-this.model.get("pageSize")>=0&&(s-=this.model.get("pageSize")),t.updateHash(this.updateSignaturesHash(i,s,{}))},render:function(){var e,t,a,s=this.model.get("dataProperties").properties,i=this.model.get("resultsCount"),n=this.model.get("pageSize"),r=this.model.get("selectedValue"),o=Math.ceil(i/n),l=[],c=r-s.treshold/2,d=r+s.treshold/2;if(c<0&&(d+=Math.abs(c)),d>o&&(c-=d-o),s.treshold>=o)for(t=0;t<o;t++)l.push({number:t+1,offset:t*n});else for(t=1;t<=o;t++)1===t||t===o?l.push({number:t,offset:(t-1)*n}):t>=c&&t<=d&&l.push({number:t,offset:(t-1)*n});e={previous:s.previous,first:s.first,next:s.next,last:s.last,pages:l,selectedValue:r},a=_.template(this.model.get("template"))({data:e}),this.$el.html(a),this.handleButtonState(r,o)},handleButtonState:function(e,t){this.$el.find(".page-selector-item-last, .page-selector-item-next").removeClass("inactive"),this.$el.find(".page-selector-item-first, .page-selector-item-previous").removeClass("inactive"),0==t?(this.$el.find(".page-selector-item-first, .page-selector-item-previous").addClass("inactive"),this.$el.find(".page-selector-item-last, .page-selector-item-next").addClass("inactive")):(1==e&&this.$el.find(".page-selector-item-first, .page-selector-item-previous").addClass("inactive"),e==t&&this.$el.find(".page-selector-item-last, .page-selector-item-next").addClass("inactive"))},handleLoadedData:function(e){var a,s,i,n=this,r=this.model.get("dataProperties").properties.searchResultsSignature.split(",");t.parseHashParameters(window.location.hash);for(void 0===e.offset&&(e.offset=0),i=0;i<r.length;i++)encodeURIComponent(r[i])===e.searchResultsSignature&&(e.pageSize>e.dataCount||e.offset>e.dataCount?(this.updateModelAfterSearch(e,1),setTimeout(function(){s=t.parseHashParameters(window.location.hash),""!==e.searchResultsSignature?s[e.searchResultsSignature+"_e"]=0:s.e=0,Backbone.history.navigate(n.createFirstPageUrlHash(s),{trigger:!0,replace:!0})},100)):(a=Math.ceil(e.offset/e.pageSize)+1,this.updateModelAfterSearch(e,a)))},createFirstPageUrlHash:function(e){var t="",a=0;return _.each(e,function(e,s){a>0&&(t+="&"),a++,t+=s+"="+e}),t}}),i.init=function(){if(!e("body").hasClass("on-page-editor")&&!n){t=XA.component.search.query;var i=e(".page-selector");_.each(i,function(t){new s({el:e(t),model:new a})}),n=!0}},i}(jQuery,document),XA.register("searchPageSelector",XA.component.search.pageSelector),XA.component.search.pageSize=function(e){var t,a,s={},i=!1,n=Backbone.Model.extend({defaults:{sig:[]}}),r=XA.component.search.baseView.extend({clicks:0,initialize:function(){var e=this,t=this.getCurrentPageSize(),a=this.$el.data().properties;this.model.set("sig",this.translateSignatures(a.searchResultsSignature,"p")),this.selectOption(t),void 0===t&&""!==a.defaultPageSize&&e.selectOption(a.defaultPageSize),XA.component.search.vent.on("hashChanged",function(t){for(var a=e.model.get("sig"),s=0;s<a.length;s++)t.hasOwnProperty(a[s])&&e.selectOption(t[a[s]])})},events:{"click select":"updatePageSizeClick","change select":"updatePageSizeSelect"},getCurrentPageSize:function(){t.parseHashParameters(window.location.hash);for(var e=this.model.get("sig"),a=0;a<e.length;a++)if(hash.hasOwnProperty(e[a]))return hash[e[a]]},selectOption:function(e){if(void 0!==e){var t=this.$el.find("select option[value='"+e+"']");t.siblings().removeAttr("selected"),t.attr("selected","selected")}},updatePageSizeClick:function(t){if(this.clicks++,2===this.clicks){var a=e(t.target).find("option:selected").val();void 0!==a&&this.updatePageSize(a),this.clicks=0}},updatePageSize:function(e){var t=this.model.get("sig");a.updateHash(this.updateSignaturesHash(t,e,{}))},updatePageSizeSelect:function(e){var t=e.currentTarget.value;this.updatePageSize(t)}});return s.init=function(){if(!e("body").hasClass("on-page-editor")&&!i){t=XA.component.search.query,a=XA.component.search.parameters,XA.component.search.results.searchResultModels;var s=e(".page-size");_.each(s,function(t){new r({el:e(t),model:new n})}),i=!0}},s.getDefaultPageSizes=function(){var t,a,s,i,n,r=e(".page-size"),o=[];if(r.length>0){for(a=0;a<r.length;a++)i=(t=(n=e(r[a])).data()).properties.searchResultsSignature.split(","),s=t.properties.defaultPageSize,o.push({signatures:i,defaultPageSize:""!==s?s:n.find("select option:first-child").val()});return o}return-1},s}(jQuery,document),XA.register("searchPageSize",XA.component.search.pageSize),XA.component.search.parameters=function(e){var t,a={},s=!1,i={};return a.init=function(){e("body").hasClass("on-page-editor")||s||(t=XA.component.search.query,XA.component.search.results.searchResultModels,s=!0)},a.registerDefault=function(e){_.each(e,function(t,a){i[a]=e[a].toString()})},a.updateHash=function(e){_.each(e,function(t,a){i[a]===e[a].toString()&&(e[a]="")}),t.updateHash(e)},a}(jQuery,document),XA.register("searchParameters",XA.component.search.parameters),XA.component.search.query=(jQuery,document,new(Backbone.Model.extend({defaults:{hash:"",hashObj:{}},initialize:function(){var e=window.location.hash;e.length&&(this.set({hash:e}),this.createHashObj())},createHashObj:function(){this.set({hashObj:this.parseHashParameters(this.get("hash"))})},parseHashParameters:function(e){var t,a,s,i,n;if(null===e||""===e)return{};for(t={},a=(a=(e=e||window.location.hash).slice(e.indexOf("#")+1).split("&")).filter(function(e){return""!==e}),s=0;s<a.length;s++)n=(i=a[s].split("="))[0].toLowerCase(),t[decodeURIComponent(n)]=i.length>1?decodeURIComponent(i[1].replace("+"," ")):null;return t},updateHash:function(e,t){var a,s="#",i=this.parseHashParameters(window.location.hash);_.each(e,function(e,t){""!==e?i[t]=e:delete i[t]}),("#"===t||null==t)&&(t=window.location.pathname),a=0,_.each(i,function(e,t){a>0&&(s+="&"),a++,s+=t+"="+encodeURIComponent(e).replace("%7C","|")}),Backbone.history.navigate(s,{trigger:!0}),s.length&&(this.set({hash:s}),this.createHashObj())},isSignaturePresentInHash:function(e,t){for(var a=Object.keys(e),s=!1,i=a.length,n=0;n<i;n++)if(a[n].startsWith(t)){s=!0;break}return s}}))),XA.component.search.radiusFilter=function(e){var t,a,s,i,n={};return a=Backbone.Model.extend({defaults:{properties:[],selected:{},sig:[]}}),s=XA.component.search.baseView.extend({initialize:function(){var t=_.map(this.$el.find("li[data-value][data-title]"),function(t){return e(t)}),a=this.$el.data("properties");_.each(t,function(e){e.addClass("radius-button")}),this.model.set({properties:a,selected:{}}),this.model.bind("change",this.render,this),this.model.set("sig",this.translateSignatures(a.searchResultsSignature,a.f)),XA.component.search.vent.on("hashChanged",this.hashChanged.bind(this)),this.render()},events:{"click li":"radiusClick","click .bottom-remove-filter, .clear-filter":"deselect"},render:function(){var t;t=this.model.get("selected"),this.$el.find(".selected").removeClass("selected"),void 0!==t&&t.length?t.addClass("selected"):(t=this.$el.find("[data-value='-1']")).length&&t.length>=1&&e(t[0]).addClass("selected")},updateHash:function(e){var t=this.model.get("sig");e=-1==e?"":e,i.updateHash(this.updateSignaturesHash(t,e,{}))},radiusClick:function(t){var a=e(t.currentTarget);this.updateHash(a.data("value")),this.model.set({selected:a})},deselect:function(){this.updateHash(""),this.model.set({selected:void 0})},hashChanged:function(t){for(var a,s,i,n=this,r=this.model.get("sig"),o=0;o<r.length;o++)a=r[o].toLowerCase(),t.hasOwnProperty(a)&&(s=""===(s=t[a])?-1:s,(i=n.$el.find("[data-value='"+s+"']")).length&&i.length>=1?n.model.set({selected:e(i[0])}):n.model.set({selected:void 0}))}}),t=function(e){var t=new a;new s({el:e[0],model:t});e.addClass("initialized")},n.init=function(){if(!e("body").hasClass("on-page-editor")){var a=e(".radius-filter:not(.initialized)");_.each(a,function(a){t(e(a))}),i=XA.component.search.query,XA.component.search.url}},n}(jQuery,document),XA.register("radiusFilter",XA.component.search.radiusFilter),XA.component.search.results=function(e){"use strict";var t,a={},s=[],i=[],n=!1,r=Backbone.Model.extend({defaults:{template:"<% if(!results.length){ %><div class='no-results'><%= noResultsText %></div> <% }else { %><ul class='search-result-list'> <% _.forEach(results, function(result){ %><li <% if(result.Geospatial){%>data-id='<%= result.Id %>' data-longitude='<%= result.Geospatial.Longitude %>' data-latitude='<%= result.Geospatial.Latitude %>'<% } %>><%= result.Html %></li><% }); %></ul><% } %><div class='search-result-overlay'>",templateItems:"<% _.forEach(results, function(result){ %><li <% if(result.Geospatial){%>data-id='<%= result.Id %>' data-longitude='<%= result.Geospatial.Longitude %>' data-latitude='<%= result.Geospatial.Latitude %>'<% } %>><%= result.Html %></li><% }); %>",dataProperties:{},blockNextRequest:!1,noResultsText:"",resultData:{},loadingInProgress:!1,loadingMoreInProgress:!1,resultDataMore:{},loadMoreOffset:0,loadMore:!1},initialize:function(){var e=t.parseHashParameters(window.location.hash),a=encodeURIComponent(this.get("dataProperties").sig),s="e_"+a;e.hasOwnProperty("e")&&""===a&&this.set("loadMoreOffset",parseInt(e.e)),e.hasOwnProperty(s)&&this.set("loadMoreOffset",parseInt(e[s])),XA.component.search.vent.on("results-loaded",this.resultsLoaded.bind(this)),XA.component.search.vent.on("results-loading",this.resultsLoading.bind(this))},blockRequests:function(e){this.set("blockNextRequest",e)},checkBlockingRequest:function(){return this.get("blockNextRequest")},getMyOffset:function(){var e=t.parseHashParameters(window.location.hash),a=encodeURIComponent(this.get("dataProperties").sig);return e.hasOwnProperty("e_"+a)?e["e_"+a]:0},resultsLoaded:function(e){encodeURIComponent(this.get("dataProperties").sig)===e.searchResultsSignature&&(this.get("loadMore")?(this.set({resultDataMore:e}),this.set({loadingMoreInProgress:!1}),this.unset("loadMore",{silent:!0})):(this.set({resultData:e}),this.set({loadingInProgress:!1})),this.blockRequests(!1))},resultsLoading:function(e){this.cid==e&&(this.get("loadMore")?this.set({loadingMoreInProgress:!0}):this.set({loadingInProgress:!0}))}}),o=Backbone.View.extend({initialize:function(){var e=this.$el.data(),t=this.$el.find(".no-results").html(),a=this;null===e.properties.sig&&(e.properties.sig=""),this.model&&this.model.set({dataProperties:e.properties,noResultsText:t}),this.model.on("change:loadingInProgress",this.loading,this),this.model.on("change:loadingMoreInProgress",this.loadingMore,this),this.model.on("change:resultData",this.render,this),this.model.on("change:resultDataMore",this.renderPart,this),XA.component.search.vent.on("add-variant-class",function(e){var t=a.model.get("dataProperties").sig;e.sig===t&&(a.$el.removeClass(a.$el.attr("data-class-variant")),a.$el.attr("data-class-variant",e.classes),a.$el.addClass(e.classes))}),XA.component.search.vent.on("loadMore",function(e){var t=a.model.get("dataProperties").sig;e.sig===t&&XA.component.search.service.getData({loadMore:"true",p:a.model.get("dataProperties").p,singleRequestMode:t})}),XA.component.search.vent.on("my-location-coordinates-changed",function(e){e.sig===a.model.get("dataProperties").sig&&a.model.get("loadMore")&&a.$el.find(".search-result-list").html("")}),this.render()},events:{"click .search-result-list > li[data-longitude][data-latitude]":"poiClick"},loading:function(){this.model.get("loadingInProgress")?this.$el.addClass("loading-in-progress"):this.$el.removeClass("loading-in-progress")},loadingMore:function(){this.model.get("loadingMoreInProgress")?this.$el.addClass("loading-more-in-progress"):this.$el.removeClass("loading-more-in-progress")},renderPart:function(){var e=_.template(this.model.get("templateItems"))({results:this.model.get("resultDataMore").data});this.$el.find(".search-result-list").append(e)},render:function(){var e,t=this,a=t.model.get("resultData").data;window.location.href.startsWith("file://")||(void 0===a&&(a=[]),e=_.template(t.model.get("template"))({results:a,noResultsText:t.model.get("noResultsText")}),this.$el.html(e))},poiClick:function(t){var a=e(t.currentTarget);XA.component.search.vent.trigger("center-map",{sig:this.model.get("dataProperties").sig,coordinates:[a.data("latitude"),a.data("longitude")],id:a.data("id")})}});return a.init=function(){if(!e("body").hasClass("on-page-editor")&&!n){XA.component.search.url,t=XA.component.search.query,XA.component.search.ajax;var a=e(".search-results");_.each(a,function(t){var a=new r;i.push(a),s.push(new o({el:e(t),model:a}))}),n=!0}},a.searchResultViews=s,a.searchResultModels=i,a}(jQuery,document),XA.register("searchResults",XA.component.search.results),XA.component.search.results.count=function(e){var t={},a=!1,s=Backbone.View.extend({initialize:function(){this.$el.data();var r=this.$el.find(".results-count"),t=this;if(this.resultsCountText=r.html(),window.location.href.startsWith("file://"))return r.html(t.resultsCountText.replace("{count}",1)),void t.$el.find(".results-count").show();XA.component.search.vent.on("results-loaded",function(a){var s=t.resultsCountText.replace("{count}",a.dataCount);s=s.replace("{query}",e("<div/>").text(XA.component.search.query.attributes.hashObj.q).html()),r.html(s),t.$el.find(".results-count").show()})}});return t.init=function(){if(!e("body").hasClass("on-page-editor")&&!a){var t=e(".search-results-count");_.each(t,function(t){new s({el:e(t)})}),a=!0}},t}(jQuery,document),XA.register("searchResultsCount",XA.component.search.results.count),XA.component.search.facet.resultsfilter=function(e){var t,a={},s=!1,n=XA.component.search.baseModel.extend({defaults:{template:"<div class='facet-search-filter'><% _.forEach(facet.Values, function(value){%><p class='facet-value' data-facetValue='<%= value.Name !== '' ? encodeURI(value.Name) : '_empty_' %>'><span><%= value.Name !== '' ? value.Name : emptyText %> <span class='facet-count'>(<%= value.Count %>)</span></span></p><% }); %></div>",templateMulti:"<div class='facet-search-filter'><% _.forEach(facet.Values, function(value){%><p class='facet-value' data-facetValue='<%= value.Name !== '' ? encodeURI(value.Name) : '_empty_' %>'><input type='checkbox' name='facetValue' /><label for='facetName'><%= value.Name !== '' ? value.Name : emptyText %> <span class='facet-count' data-facetCount='<%= value.Count %>'>(<%= value.Count %>)</span></label></p><% }); %></div>",dataProperties:{},blockNextRequest:!1,resultData:{},timeStamp:"",sig:[]},initialize:function(){XA.component.search.vent.on("facet-data-loaded",this.processData.bind(this)),XA.component.search.vent.on("facet-data-partial-filtered",this.processData.bind(this)),XA.component.search.vent.on("facet-data-filtered",this.processData.bind(this)),XA.component.search.vent.on("hashChanged",this.updateComponent.bind(this)),this.set({facetArray:[]})},toggleBlockRequests:function(){var e=this.get("blockNextRequest");this.set(this.get("blockNextRequest"),!e)},processData:function(e){var t,a,s=this,i=this.get("dataProperties"),n=i.searchResultsSignature.split(","),r=i.sortOrder;for(null===e.Signature&&(e.Signature=""),t=0;t<n.length;t++)e.Facets.length>0&&e.Signature===n[t]&&(void 0!==(a=_.find(e.Facets,function(e){return e.Key.toLowerCase()===s.get("dataProperties").f.toLowerCase()}))&&(this.sortFacetArray(r,a.Values),s.set({resultData:a})))},updateFacetArray:function(e){var t,a,s;if(e){for(t=e.split(","),a=this.get("facetArray"),s=0;s<t.length;s++)a.push(t[s]);this.set({facetArray:_.unique(a)})}},updateComponent:function(e){var t=this.get("sig");for(i=0;i<t.length;i++)e.hasOwnProperty(t[i])?this.updateFacetArray(e[t[i]]):this.set({facetArray:[]}),this.set("timeStamp",(new Date).getTime())}}),r=XA.component.search.baseView.extend({initialize:function(){var e,a,s,i=this.$el.data(),n=t.parseHashParameters(window.location.hash),r=i.properties;for(null===i.properties.searchResultsSignature&&(i.properties.searchResultsSignature=""),e=this.translateSignatures(r.searchResultsSignature,r.f),this.model.set({dataProperties:r}),this.model.set("sig",e),a=0;a<e.length;a++)jQuery.isEmptyObject(_.pick(n,e[a]))||(s=_.values(_.pick(n,e[a]))[0],this.model.updateFacetArray(s));this.model.on("change",this.render,this)},events:{"click .facet-value":"updateFacet","click .filterButton":"updateFacet","click .clear-filter":"removeFacet","click .bottom-remove-filter > button":"removeFacet"},updateFacet:function(a){var s,i,n=e(a.currentTarget),r=this.model.get("facetArray"),o=this.model.get("dataProperties"),l=this.$el.find(".facet-heading > span"),c=n.parents(".component-content").find(".facet-search-filter"),d=o.f.toLowerCase(),h=n.data("facetvalue"),u=void 0!==h?decodeURIComponent(h):h,p=this.model.get("sig"),g={};if(o.multi){if(u&&(n.is(":not(.active-facet)")?(this.setActiveFacet(d,u),r.push(u)):(n.removeClass("active-facet"),n.find("[type=checkbox]").prop("checked",!1),n.find("[type=checkbox] + label:after").css({background:"#fff"}),(s=r.indexOf(u))>-1&&r.splice(s,1),0==r.length&&l.removeClass("has-active-facet")),this.model.set({facetArray:r})),"button"==n[0].type){for(i=0;i<p.length;i++)g[p[i]]=_.uniq(r,function(e){return JSON.stringify(e)}).toString();t.updateHash(g)}}else if(u){for(i=0;i<p.length;i++)g[p[i]]=u;c.data("active-facet",g),this.setActiveFacet(d,u),t.updateHash(g)}},removeFacet:function(a){a.preventDefault();var s=this.$el,i=s.find(".facet-heading > span"),n=s.find(".facet-value"),r=this.model.get("sig");t.updateHash(this.updateSignaturesHash(r,"",{})),i.removeClass("has-active-facet"),_.each(n,function(t){var a=e(t);a.hasClass("active-facet")&&(a.removeClass("active-facet"),a.find("[type=checkbox]").prop("checked",!1),a.find("[type=checkbox] + label:after").css({background:"#fff"}))}),this.model.set({facetArray:[]})},render:function(){var e,a,s=this,i=this.model.get("resultData"),n=this.$el.find(".facet-heading > span"),r=this.model.get("dataProperties").f.split("|"),o=this.model.get("dataProperties").emptyValueText,l=this.model.get("dataProperties").highlightThreshold,c=t.parseHashParameters(window.location.hash),d=this.model.get("sig");window.location.href.startsWith("file://")||(void 0!==i&&(a=(!0===s.model.get("dataProperties").multi?_.template(s.model.get("templateMulti")):_.template(s.model.get("template")))({facet:i,emptyText:o})),s.$el.find(".contentContainer").html(a),_.each(r,function(t){var a,i;for(e=t.toLowerCase(),a=0;a<d.length;a++)if(!jQuery.isEmptyObject(_.pick(c,d))&&(i=_.values(_.pick(c,d))[0]))return void s.setActiveFacet(e,i)}),l&&this.handleThreshold(l),0===this.model.get("facetArray").length?n.removeClass("has-active-facet"):n.addClass("has-active-facet"))},setActiveFacet:function(t,a){var s,i,n=this.model.get("dataProperties"),r=this.$el.find("p[data-facetvalue]"),o=this.$el.find(".facet-heading > span"),l=this;a=a.toString().toLowerCase(),s=this.$el.find("[data-facetvalue]").filter(function(){return decodeURIComponent(e(this).attr("data-facetvalue").toLowerCase())===a}),null!=a&&((i=a.split(",")).length>1&&(n.multi=!0),n.multi?_.each(r,function(t){if(i.length>1)for(var a=0,n=i.length;a<n;a++)t===(s=l.$el.find("[data-facetvalue]").filter(function(){return e(this).attr("data-facetvalue").toLowerCase()===i[a]}))[0]&&(e(t).addClass("active-facet"),e(t).find("[type=checkbox]").prop("checked",!0));t===s[0]&&(e(t).addClass("active-facet"),e(t).find("[type=checkbox]").prop("checked",!0))}):_.each(r,function(t){t!==s[0]?(e(t).removeClass("active-facet"),e(t).find("[type=checkbox]").prop("checked",!1),e(t).find("[type=checkbox] + label:after").css({background:"#fff"})):e(t).addClass("active-facet")}),o.addClass("has-active-facet"))},handleThreshold:function(t){var a=this.$el.find(".facet-search-filter").children("p");_.each(a,function(a){var s=e(a).find(".facet-count");s.data("facetcount")>t&&s.addClass("highlighted")})}});return a.init=function(){if(!e("body").hasClass("on-page-editor")&&!s){t=XA.component.search.query,XA.component.search.ajax,XA.component.search.url;var a=e(".facet-single-selection-list");_.each(a,function(t){var a=new n;new r({el:e(t),model:a})}),s=!0}},a.getFacetDataRequestInfo=function(){var t=e(".facet-single-selection-list"),a=[];return _.each(t,function(t){for(var s=e(t).data().properties,i=s.searchResultsSignature.split(","),n=0;n<i.length;n++)a.push({signature:null===i[n]?"":i[n],facetName:s.f,endpoint:s.endpoint,s:s.s,filterWithoutMe:!s.collapseOnSelection})}),a},a}(jQuery,document),XA.register("facetResultsFilter",XA.component.search.facet.resultsfilter),XA.component.search.sort=function(e){var t,a={},s=Backbone.Model.extend({defaults:{updateOrder:!1,sig:[]}}),i=XA.component.search.baseView.extend({initialize:function(){var e=this.$el.data();this.model&&this.model.set("sig",this.translateSignatures(e.properties.sig,"o")),XA.component.search.vent.on("hashChanged",this.updateComponent.bind(this))},events:{"click .sort-results-group a":"sortSearchResultsLink","change select":"sortSearchResultsSelect"},sortSearchResultsLink:function(t){t.preventDefault(),this.sortSearchResults(e(t.currentTarget).parent())},sortSearchResultsSelect:function(t){this.sortSearchResults(e(t.currentTarget[t.currentTarget.options.selectedIndex]))},sortSearchResults:function(e){var a=e.data(),s=this.model.get("sig"),i=a.facet+","+a.direction;""!==a.direction?t.updateHash(this.updateSignaturesHash(s,i,{})):t.updateHash(this.updateSignaturesHash(s,"",{}))},updateComponent:function(e){for(var t,a,s=this.model.get("sig"),i=0;i<s.length;i++)e.hasOwnProperty(s[i])?(a=e[s[i]].split(","),t=this.$el.find("[data-facet='"+a[0]+"'][data-direction='"+a[1]+"']")):t=this.$el.find("[data-facet][data-direction]:first");this.$el.find("[data-facet][data-direction]").removeAttr("selected"),t.attr("selected","selected")}});return a.init=function(){if(!e("body").hasClass("on-page-editor")){XA.component.search.query,t=XA.component.search.parameters;var a=e(".sort-results");_.each(a,function(t){var a=new s;new i({el:e(t),model:a})}),initialzied=!0}},a.getFirstSortingOption=function(t){for(var a,s,i,n=e(".sort-results"),r=0;r<n.length;r++)if(void 0!==t)for(s=e(n[r]).data().properties.sig.split(","),i=0;i<s.length;i++)if(s[i]===t&&""!==(a=e(n[r]).find("[data-facet][data-direction]").data()).direction)return a.facet+","+a.direction;return-1},a}(jQuery,document),XA.register("searchSort",XA.component.search.sort),XA.component.search.url=function(e){var t=function(e){var t,a=(e+="").split(","),s=[];return _.each(a,function(e){t=e.split("|"),_.contains(e,"|")&&3===t.length?s.push(t[1]+"|"+t[2]):s.push(e)}),s.join(",")};return new(Backbone.Model.extend({createSearchUrl:function(e,t){var a=this.setEndpoint(e.endpoint);return a+=e.l?"&l="+e.l:"",a+=e.s?"&s="+e.s:"",a+=e.itemid?"&itemid="+e.itemid:"",a+=this.getFacetParams(e,t),this.fixUrl(a)},createRedirectSearchUrl:function(t,a,s,i){var n,r,o,l,c=XA.component.search.query.get("hashObj"),d={},h={},u=0;if(""!==s)for(o in c)n=o.substring(o.indexOf("_")+1),(r=o.substr(0,o.indexOf("_")))===s&&(h[o]=c[o]);else h=c;if(a=e.extend({},h,a),""!==i)for(o in a)n=o.substring(o.indexOf("_")+1),(r=o.substr(0,o.indexOf("_")))===s?d[i+"_"+n]=a[o]:r===i&&(d[o]=a[o]);else d=a;return l=this.setEndpoint(t+"#"),_.each(d,function(e,t){l+=(0===u?"":"&")+t+"="+e,u++}),l},createPredictiveSearchUrl:function(e,t,a){var s=this.setEndpoint(e);return s+="?q="+encodeURIComponent(a),s+="&v="+t.v,s+="&p="+t.p,s+=t.l?"&l="+t.l:"",(s+=t.s?"&s="+t.s:"")+(t.itemid?"&itemid="+t.itemid:"")},createFacetUrl:function(e,t){var a=this.setEndpoint(e.endpoint);return a+="?f="+e.f.toLowerCase(),a+=e.s?"&s="+e.s:"",a+=e.l?"&l="+e.l:"",(a+=t?"&q="+encodeURIComponent(t):"")+this.getFacetParams(e)},createMultiFacetUrl:function(e,t,a,s){var i=this.setEndpoint(e.endpoint);return i+="?f="+t.join(",").toLowerCase(),i+=e.s?"&s="+e.s:"",i+=e.l?"&l="+e.l:"",i+=e.q?"&q="+encodeURIComponent(e.q):"",i+=s?"&itemid="+s:"",(i+=this.getFacetParams(e,a))+"&sig="+encodeURIComponent(a)},clearUrlParams:function(e,t){var a=e.f.toLowerCase(),s={};return delete t[a],delete s[a],XA.component.search.query.updateHash(s),t},getFacetParams:function(e,a){var s,i="",n=["endpoint","l","s","e","f","sig","itemid"],r=["g","o","q","p","e","v"];for(facet in e.hasOwnProperty("sig")&&(i+="&sig="+encodeURIComponent(e.sig)),e)-1===n.indexOf(facet)&&facet&&e[facet]&&(s=facet.substring(facet.indexOf("_")+1),a===facet.substr(0,facet.indexOf("_"))&&-1===r.indexOf(s)&&(i+="&"+s+"="+encodeURI(t(e[facet]))));return this.getSpecialParams(e,a,r,i)},getSpecialParams:function(e,t,a,s){var i,n,r,o;for(i in e)r=i.substring(i.indexOf("_")+1),o=i.substr(0,i.indexOf("_")),-1!==a.indexOf(r)&&(n=void 0!==e[i]?e[i]:"",t===o&&(s+="&"+r+"="+encodeURIComponent(n)));return s},createGetPoiContentUrl:function(e,t,a){return this.setEndpoint(e.endpoint)+"/"+a+"/"+t},createGetGeoPoiContentUrl:function(e,t,a,s,i){return this.setEndpoint(e.endpoint)+"/"+a+"/"+t+"/"+s+"/"+i},createSiteUrl:function(e,t){return null!=t&&""!==t?e+"&sc_site="+t+"&site="+t:e},setEndpoint:function(e){var t=window.location.origin;return-1!==e.indexOf(t)?e:t+e},fixUrl:function(e){var t;return t=(e=e.replace(/[?]/g,"&")).indexOf("&"),e.substr(0,t)+"?"+e.substr(t+1)}}))}(jQuery,document),XA.component.search.variantFilter=function(e){var t,a,s={},i=[],n=!1,r=(i={},Backbone.Model.extend({defaults:{dataProperties:{},sig:[]}})),o=XA.component.search.baseView.extend({initialize:function(){var e,a=t.parseHashParameters(window.location.hash),s=this.$el.data(),n=this.translateSignatures(s.properties.searchResultsSignature,"v"),r=this;for(null===s.properties.searchResultsSignature&&(s.properties.searchResultsSignature=""),this.model.set({dataProperties:s}),this.model.set("sig",n),e=0;e<n.length;e++)a.hasOwnProperty(n[e])&&this.selectVariantIcon(a[n[e]]);XA.component.search.vent.on("results-loaded",function(){var o,l,c=s.properties.searchResultsSignature.split(",");for(a=t.parseHashParameters(window.location.hash),e=0;e<c.length;e++)o=c[e],a.hasOwnProperty(n[e])&&i.hasOwnProperty(o)?(l=i[o][a[n[e]]],r.triggerAddVariant(l.cssClass,o),r.selectVariantIcon(a[n[e]])):i.hasOwnProperty(o)&&i[o].hasOwnProperty(0)&&setTimeout(function(){r.triggerAddVariant(i[o][0].cssClass,o),r.selectVariantIcon(0)},100)})},events:{"click div > div":"changeVariant"},changeVariant:function(t){var s=e(t.currentTarget),i=this.model.get("sig"),n=s.data();this.$el.find(".active-variant").removeClass("active-variant"),s.addClass("active-variant"),a.updateHash(this.updateSignaturesHash(i,n.variantindex,{})),this.triggerAddVariant(e(t.currentTarget).attr("class"))},triggerAddVariant:function(e,t){XA.component.search.vent.trigger("add-variant-class",{classes:e,sig:t})},selectVariantIcon:function(e){this.$el.find("div[data-variantIndex]").removeClass("active-variant"),this.$el.find("div[data-variantIndex="+e+"]").addClass("active-variant")}});return s.init=function(){if(!e("body").hasClass("on-page-editor")&&!n){t=XA.component.search.query,a=XA.component.search.parameters;var s=e(".variant-selector");_.each(s,function(t){new o({el:e(t),model:new r})}),n=!0}},s.getVariantMappings=function(t){var a,s,n=e(".variant-selector"),r={};if(!i.hasOwnProperty(t))for(s=0;s<n.length;s++)-1!==e(n[s]).data().properties.searchResultsSignature.split(",").indexOf(t)&&(a=e(n[s]).find(".variant-option"),_.each(a,function(t){var a=e(t).data();r[a.variantindex]={id:a.variant,cssClass:e(t).attr("class")}}),i[t]=r);return i.hasOwnProperty(t)?i[t]:{}},s}(jQuery,document),XA.register("variantFilter",XA.component.search.variantFilter),XA.component.search.service=function(e){"use strict";var t=XA.component.search.results.searchResultModels,a=XA.component.search.url,s=XA.component.search.query,i=XA.component.search.parameters,n=XA.component.search.ajax;return new(Backbone.Model.extend({defaults:{},initialize:function(){var e=this;XA.component.search.vent.on("orderChanged",function(t){e.getData(t)})},getData:function(e){t.length>0?this.getSearchResultsData(e):this.getEndpointAndSearch(e)},getSearchResultsData:function(i){var r,o,l,c,d,h,u,p=s.parseHashParameters(window.location.hash),g=this;_.each(t,function(t){if(d=null!==t.get("dataProperties").sig?encodeURIComponent(t.get("dataProperties").sig):"",o=""!==d?d+"_e":"e",(t.get("dataProperties").autoFireSearch||p&&s.isSignaturePresentInHash(p,d))&&(r=t.get("dataProperties").defaultSortOrder,l=t.get("dataProperties").p,c=t.get("dataProperties").v,void 0===i||!i.hasOwnProperty("singleRequestMode")||i.singleRequestMode==d)){if((p=g.getDefaultDefaultPageSize(d,l,p)).hasOwnProperty("l")&&""===p.l&&(p.l=t.get("dataProperties").l),h=e.extend({},t.get("dataProperties"),p),(h=e.extend(h,i)).hasOwnProperty("loadMore")){t.set("loadMore",!0),delete h.loadMore;var f=t.get("loadMoreOffset")+h.p;t.set("loadMoreOffset",f),h[o]=f}else t.get("loadMoreOffset")&&(0!==h.p&&(h.p=h.p*(1+t.get("loadMoreOffset")/h.p),h[o]=0,t.set("loadMoreOffset",0)),delete h.variantChanged);h=g.getSortOrder(d,h,r),h=g.setVariant(d,h,c),(u=a.createSearchUrl(h,d))&&(t.checkBlockingRequest()||(t.blockRequests(!0),XA.component.search.vent.trigger("results-loading",t.cid),n.getData({callback:function(e){e.Signature=null!==e.Signature?e.Signature:"",XA.component.search.vent.trigger("results-loaded",{dataCount:e.Count,data:e.Results,pageSize:""!==e.Signature&&h.hasOwnProperty(e.Signature+"_p")?h[e.Signature+"_p"]:h.p,offset:""!==e.Signature&&h.hasOwnProperty(e.Signature+"_e")?h[e.Signature+"_e"]:h.e,searchResultsSignature:e.Signature,loadMore:t.get("loadMore")})},url:u})))}})},getSearchData:function(t){var i,r,o,l,c=s.parseHashParameters(window.location.hash),d=e.extend({},c,d,t);for((d=this.getDefaultDefaultPageSize("",0,d)).hasOwnProperty("o")||void 0===XA.component.search.sort||-1!==(r=XA.component.search.sort.getFirstSortingOption())&&(d.o=r),d.endpoint=XA.component.map.getSearchEndpoint(),i=XA.component.map.getSignatures(),l=0;l<i.length;l++){if(d.sig=i[l],!(o=a.createSearchUrl(d,i[l])))return;n.getData({callback:function(e){e.Signature=null!==e.Signature?e.Signature:"",XA.component.search.vent.trigger("results-loaded",{dataCount:e.Count,data:e.Results,pageSize:d.p,offset:0,searchResultsSignature:e.Signature})},url:o})}},getEndpointAndSearch:function(){void 0!==XA.component.map.getSearchEndpoint()?this.getSearchData():setTimeout(this.getEndpointAndSearch.bind(this),100)},getSortOrder:function(e,t,a){var s=XA.component.search.sort.getFirstSortingOption(e),n=""!==e?e+"_o":"o",r="",o={};return-1!==s?r=s:""!==a&&(r=a),t.hasOwnProperty(n)||""===r||(delete t.defaultSortOrder,delete t.o,t[n]=r),o[n]=r,i.registerDefault(o),t},getDefaultDefaultPageSize:function(e,t,a){var s,n,r=XA.component.search.pageSize.getDefaultPageSizes(),o=""!==e?e+"_p":"p";return a.hasOwnProperty(o)||void 0===XA.component.search.pageSize||-1!==r&&((s=r.filter(function(t){return-1!==t.signatures.indexOf(e)})).length>0&&(a[o]=s[0].defaultPageSize)),a.hasOwnProperty(o)||0==t||(a[o]=t),(n={})[o]=t,i.registerDefault(n),a},setVariant:function(t,a,s){var n,r=XA.component.search.variantFilter.getVariantMappings(t),o=""!==t?t+"_v":"v";return""===t&&e.isEmptyObject(r)||(""===t&&a.hasOwnProperty(o)&&r.hasOwnProperty(a[o])?a[o]=r[a[o]].id:""===t&&r.hasOwnProperty(0)?a[o]=r[0].id:(delete a.v,a[o]=a.hasOwnProperty(o)?r[a[o]].id:r.hasOwnProperty(0)?r[0].id:s)),(n={})[o]=0,i.registerDefault(n),a}}))}(jQuery,document),XA.component.search.router=function(e){"use strict";var t,a,s={},i=!1;return a=Backbone.Router.extend({routes:{"*params":"checkUrl"},checkUrl:function(){var e=t.parseHashParameters(window.location.hash);XA.component.search.service.getData(),e?XA.component.search.facet.data.filterFacetData(e):XA.component.search.facet.data.getInitialFacetData(),XA.component.search.vent.trigger("hashChanged",e)}}),s.init=function(){if(!e("body").hasClass("on-page-editor")&&!i){t=XA.component.search.query;new a;Backbone.History.started||Backbone.history.start(),i=!0}},s}(jQuery,document),XA.register("searchRouter",XA.component.search.router),XA.component.search.facet.daterange=function(e){var t,a,s,i,n,r={};return a=function(t){return null!==t&&""!==t?e.datepicker.formatDate("yymmdd",t):""},s=function(e){var t=e.substr(0,4),a=e.substr(4,2)-1,s=e.substr(6,2),i=new Date(t,a,s);if(""!==e){if(i.getFullYear()==t&&i.getMonth()==a&&i.getDate()==s)return i;throw"Invalid date: "+e}},i=Backbone.Model.extend({defaults:{dataProperties:{},sig:[]}}),n=XA.component.search.baseView.extend({initialize:function(){this.properties=this.$el.data().properties,this.model&&(this.model.set({dataProperties:this.properties}),this.model.set("sig",this.translateSignatures(this.properties.searchResultsSignature,this.properties.f))),this.model.on("change",this.render,this),XA.component.search.vent.on("hashChanged",this.updateComponent.bind(this))},events:{"change .startDate":"updateFacet","change .endDate":"updateFacet","click .bottom-remove-filter, .clear-filter":"clearFilter"},render:function(){var a,i,n=parseInt(this.model.get("dataProperties").fromDateDefaultOffset),r=parseInt(this.model.get("dataProperties").toDateDefaultOffset),o=this.model.get("dataProperties").fromDateDisplayFormat,l=this.model.get("dataProperties").toDateDisplayFormat,c=this.model.get("dataProperties").fromDateMonthsShown,d=this.model.get("dataProperties").toDateMonthsShown,h=this.model.get("dataProperties").fromDatePastDays,u=this.model.get("dataProperties").toDateFutureDays,p=this.model.get("dataProperties").fromDateVisible,g=this.model.get("dataProperties").toDateVisible,f=this.$el.find(".startDate"),m=this.$el.find(".endDate"),v=t.parseHashParameters(window.location.hash),S=this.model.get("sig"),P=e("html").attr("lang")?e("html").attr("lang"):"";for(l&&(l=l.replace(/yy/g,"y")),o&&(o=o.replace(/yy/g,"y")),p&&(f.datepicker({dateFormat:o,changeMonth:c,changeYear:c,minDate:h?""!=n?-1*n:new Date(1900,1,1):new Date}),$xa.datepicker.setDefaults($xa.datepicker.regional[P])),g&&(m.datepicker({dateFormat:l,changeMonth:d,changeYear:d,maxDate:u?""!=r?r:new Date(2100,1,1):new Date}),$xa.datepicker.setDefaults($xa.datepicker.regional[P])),i=0;i<S.length;i++)v.hasOwnProperty(S[i])&&""!=v[S[i]]&&(a=v[S[i]].split("|"),f.datepicker("setDate",s(a[0])),m.datepicker("setDate",s(a[1])))},updateFacet:function(){var e=this.$el.find(".facet-heading > span"),s=this.$el.find(".startDate"),i=this.$el.find(".endDate"),n=s.length>0?s.datepicker("getDate"):null,r=i.length>0?i.datepicker("getDate"):null,o=this.model.get("sig");t.updateHash(this.updateSignaturesHash(o,a(n)+"|"+a(r),{})),e.addClass("has-active-facet")},clearFilter:function(){var e,a=this.model.get("dataProperties"),s=this.$el.find(".facet-heading > span"),i=t.parseHashParameters(window.location.hash),n=this.model.get("sig");for(s.removeClass("has-active-facet"),e=0;e<n.length;e++)delete a[n[e]];t.updateHash(this.updateSignaturesHash(n,"",i)),this.model.set({dataProperties:a}),this.$el.find(".startDate").val(""),this.$el.find(".endDate").val("")},updateComponent:function(e){for(var t,a,s=this.$el.find(".startDate"),i=this.$el.find(".endDate"),n=this.model.get("sig"),r=0;r<n.length;r++)t=n[r].toLowerCase(),e.hasOwnProperty(t)&&""!==e[t]?(""!==(a=e[t].split("|"))[0]&&this.handleDate(s,a[0]),""!==a[1]&&this.handleDate(i,a[1])):this.clearFilter()},handleDate:function(e,t){var i=this.$el.find(".facet-heading > span");0!==e.length&&a(e.datepicker("getDate"))!==t?(e.datepicker("setDate",s(t)),i.addClass("has-active-facet")):""===t&&e.datepicker("setDate",null)}}),r.init=function(){if(!e("body").hasClass("on-page-editor")){t=XA.component.search.query,XA.component.search.url;var a=e(".facet-date-range");_.each(a,function(t){var a=new i;new n({el:e(t),model:a}).render()}),initialzied=!0}},r}(jQuery,document),XA.register("facetDateRange",XA.component.search.facet.daterange);